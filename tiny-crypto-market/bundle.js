!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}t.exports=function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}},function(t,e){t.exports=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}},function(t,e,n){"use strict";n.r(e);var i=n(0),r=n.n(i),a=n(1),o=n.n(a),s=function(){function t(){r()(this,t),this._value=null}return o()(t,[{key:"fetch",value:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(){var t=this;return fetch("https://api.coinpaprika.com/v1/ticker").then((function(t){return t.json()})).then((function(e){return t._value=e.slice(0,10)})).catch((function(){return t._value}))}))}]),t}(),l=n(2),c=n.n(l);function u(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?u(Object(n),!0).forEach((function(e){c()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var _=function(){function t(e){var n=e.element,i=e.precision,a=e.onRowClick;r()(this,t),this._el=n,this._onRowClickCallback=a,this._animateClasses=["blink","value-raised","value-fallen"],this._PRECISION=i,this._rowSymbol=Symbol("rowEl"),this._currentItems={},this._render()}return o()(t,[{key:"updateData",value:function(t){t&&(this._isBodyRendered?this._updateBodyData(t):this._renderBody(t))}},{key:"_onRowClick",value:function(t){var e,n=t.target.closest("tr");null!==n&&(e=n.dataset.currencyId)&&this._onRowClickCallback(e)}},{key:"_render",value:function(){var t=this;this._el.innerHTML='\n            <table class="data-table highlight"> \n                <thead>\n                    <tr>\n                        <th>Name</th>\n                        <th>Symbol</th>\n                        <th>Rank</th>\n                        <th>Price</th>\n                    </tr>\n                </thead>\n                <tbody></tbody>\n            </table>\n        ',this._tableEl=this._el.firstElementChild,this._tableEl.addEventListener("click",this._onRowClick.bind(this)),this._tableEl.addEventListener("animationend",(function(e){t._animateClasses.forEach((function(t){e.target.classList.remove(t)}))})),this._isBodyRendered=!1}},{key:"_renderBody",value:function(t){var e=this,n=this._tableEl.tBodies[0];n.remove(),t.forEach((function(t){var i=n.insertRow(-1);i.dataset.currencyId=t.id,i.innerHTML="\n                <td>".concat(t.name,"</td>\n                <td>").concat(t.symbol,"</td>\n                <td>").concat(t.rank,"</td>\n                <td>").concat(e._formatPrice(t.price_usd),"</td>\n            "),e._currentItems[t.id]=d(d({},t),{},c()({},e._rowSymbol,i))})),this._tableEl.append(n),this._isBodyRendered=!0}},{key:"_updateBodyData",value:function(t){var e=this;t.forEach((function(t){var n=e._currentItems[t.id],i=t.price_usd-n.price_usd;if(0!==i){var r=n[e._rowSymbol];r.lastElementChild.textContent=e._formatPrice(t.price_usd),r.classList.add("blink"),r.lastElementChild.classList.add(i>0?"value-raised":"value-fallen"),Object.assign(n,t)}}))}},{key:"_formatPrice",value:function(t){return Number(t).toFixed(this._PRECISION)}}]),t}();function h(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function f(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?h(Object(n),!0).forEach((function(e){c()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var m=function(){function t(e){var n=e.element,i=e.precision,a=e.balance,o=e.onRowClick;r()(this,t),this._el=n,this._onRowClickCallback=o,this._animateClasses=["blink","value-raised","value-fallen"],this._amountSymbol=Symbol("amount"),this._rowSymbol=Symbol("row"),this._PRECISION=i,this._balance=a,this._worth=0,this._currentItems={},this._render()}return o()(t,[{key:"getBalance",value:function(){return this._balance}},{key:"add",value:function(t,e){var n,i=this._currentItems;i[t.id]?(n=!1,Object.assign(i[t.id],t),i[t.id][this._amountSymbol]+=e):(n=!0,i[t.id]=f(f({},t),{},c()({},this._amountSymbol,e)));var r=0;for(var a in i){var o=i[a],s=a===t.id,l=o.price_usd*o[this._amountSymbol];if(s){var u=n?this._innerEls.tbody.insertRow(-1):o[this._rowSymbol],d=this._formatPrice(l),_=this._formatPrice(o.price_usd);n?(u.dataset.currencyId=o.id,u.innerHTML="\n                        <td>".concat(o.name,"</td>\n                        <td>").concat(o[this._amountSymbol],"</td>\n                        <td>").concat(_,"</td>\n                        <td>").concat(d,"</td>\n                    "),o[this._rowSymbol]=u):(u.children[1].textContent=o[this._amountSymbol].toFixed(this._PRECISION),u.children[2].textContent=_,u.children[3].textContent=d,u.classList.add("blink"),u.children[1].classList.add("value-raised"))}r+=l}this._worth=r,this._balance-=t.price_usd*e,this._innerEls.balance.textContent="$".concat(this._formatPrice(this._balance)),this._innerEls.worth.textContent="$".concat(this._formatPrice(this._worth)),this._innerEls.balance.classList.add("value-fallen"),this._innerEls.worth.classList.add("value-raised"),this._isBodyRendered=!0}},{key:"remove",value:function(t,e){var n=this._currentItems[t.id],i=n[this._rowSymbol];if(n[this._amountSymbol]===e)i.remove(),delete this._currentItems[t.id],this._innerEls.portfolio.classList.add("blink");else{n[this._amountSymbol]-=e;var r=t.price_usd*n[this._amountSymbol];i.children[1].textContent=n[this._amountSymbol],i.lastElementChild.textContent=this._formatPrice(r),i.classList.add("blink"),i.children[1].classList.add("value-fallen"),i.lastElementChild.classList.add("value-fallen")}var a=t.price_usd*e;this._balance+=a,this._worth-=a,0===Object.values(this._currentItems).length&&(this._worth=0),this._innerEls.balance.textContent="$".concat(this._formatPrice(this._balance)),this._innerEls.balance.classList.add("value-raised"),this._innerEls.worth.textContent="$".concat(this._formatPrice(this._worth)),this._innerEls.worth.classList.add("value-fallen")}},{key:"updateData",value:function(t){t&&this._isBodyRendered&&this._updateBodyData(t)}},{key:"_onRowClick",value:function(t){var e,n=t.target.closest("tr");null!==n&&(e=n.dataset.currencyId)&&this._onRowClickCallback(e,this._currentItems[e][this._amountSymbol])}},{key:"_render",value:function(){var t=this;this._el.innerHTML='\n            <ul class="collapsible portfolio">\n                <li>\n                    <p class="collapsible-header portfolio__header">\n                        <span class="portfolio__col">Current balance:&nbsp;<b class="portfolio__balance">$'.concat(this._balance,'</b></span>\n                        <span class="portfolio__col">Portfolio Worth:&nbsp;<b class="portfolio__worth">$').concat(this._worth,'</b></span>\n                    </p>\n                    <div class="collapsible-body">\n                        <table class="highlight">\n                            <thead>\n                                <tr>\n                                    <th>Name</th>\n                                    <th>Amount</th>\n                                    <th>Price</th>\n                                    <th>Total</th>\n                                </tr>\n                            </thead>\n                            <tbody></tbody>\n                        </table>\n                    </div>\n                </li>\n            </ul>\n        '),this._el.addEventListener("animationend",(function(e){t._animateClasses.forEach((function(t){e.target.classList.remove(t)}))})),this._el.addEventListener("click",this._onRowClick.bind(this)),M.Collapsible.init(this._el.querySelectorAll(".collapsible")),this._innerEls={portfolio:this._el.querySelector(".portfolio"),balance:this._el.querySelector(".portfolio__balance"),worth:this._el.querySelector(".portfolio__worth"),tbody:this._el.querySelector("tbody")},this._isBodyRendered=!1}},{key:"_updateBodyData",value:function(t){var e=this,n=!1,i=0;if(t.forEach((function(t){var r=e._currentItems[t.id];if(r){var a=t.price_usd-r.price_usd;if(i+=t.price_usd*r[e._amountSymbol],0!==a){n=!0;var o=r[e._rowSymbol];o.children[2].textContent=e._formatPrice(t.price_usd),o.classList.add("blink"),o.children[2].classList.add(a>0?"value-raised":"value-fallen"),o.lastElementChild.textContent=e._formatPrice(r[e._amountSymbol]*t.price_usd),Object.assign(r,t)}}})),n){var r=i-this._worth;0!==r&&(this._worth=i,this._innerEls.portfolio.classList.add("blink"),this._innerEls.worth.textContent="$".concat(this._formatPrice(i)),this._innerEls.worth.classList.add(r>0?"value-raised":"value-fallen"))}}},{key:"_formatPrice",value:function(t){return Number(t).toFixed(this._PRECISION)}}]),t}(),b=function(){function t(e){var n=e.element,i=e.precision,a=e.onBuy,o=e.onSell;r()(this,t),this._el=n,this._PRECISION=i,this._INPUT_MIN=Math.pow(10,-Math.pow(i,3)),this._onBuyCallback=a,this._onSellCallback=o,this._render()}return o()(t,[{key:"buy",value:function(t){var e=t.item,n=t.balance;this._isBuyingCtx=!0,this._currentItem=e,this._balance=n,this._show()}},{key:"sell",value:function(t){var e=t.item,n=t.itemAmount;this._isBuyingCtx=!1,this._currentItem=e,this._itemAmount=n,this._show()}},{key:"close",value:function(){this._resetState(),this._modal.close()}},{key:"_show",value:function(){var t=this._isBuyingCtx,e=this._innerEls;e.titleText.textContent=t?"Buying":"Selling",e.titleItem.textContent=this._currentItem.name,e.currentPrice.textContent=this._formatPrice(this._currentItem.price_usd),e.tradeText.textContent=t?"Current balance":"Current amount",e.tradeValue.textContent=t?this._balance:this._itemAmount,e.tradeAllText.textContent=t?"Buy":"Sell",e.submitBtn.textContent=t?"Buy":"Sell",this._wasFormTouched=!1,this._updateAmount(),this._modal.open()}},{key:"_updateAmount",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._amount=t,this._total=this._currentItem.price_usd*t,this._innerEls.total.textContent=this._formatPrice(this._total),this._wasFormTouched&&this._reportAmountError()}},{key:"_reportAmountError",value:function(){var t,e,n=this._isBuyingCtx;n?(t=this._total>this._balance,e=0===this._amount):(t=this._amount>this._itemAmount,e=0===this._amount),this._isAmountError=t||e;var i="";return this._isAmountError&&(i=e?"Please enter amount of currency you want to ".concat(n?"buy":"sell","."):n?"Total sum is more than yor balance.":"Amount of currency entered is more than you have."),this._innerEls.amountInp.classList.toggle("invalid",this._isAmountError),this._innerEls.formFeedback.classList.toggle("error",this._isAmountError),this._innerEls.formFeedback.textContent=i,this._innerEls.submitBtn.disabled=this._isAmountError,!this._isAmountError}},{key:"_reportValidity",value:function(){return this._reportAmountError()&&this._innerEls.form.checkValidity()}},{key:"_resetState",value:function(){this._isAmountError=!1,this._innerEls.amountInp.value="",this._innerEls.amountInp.classList.remove("invalid"),this._innerEls.amountLabel.classList.remove("active"),this._innerEls.formFeedback.textContent="",this._innerEls.formFeedback.classList.remove("error")}},{key:"_render",value:function(){var t=this;this._el.innerHTML='\n            <div class="widget modal" id="modal">\n                <div class="modal-content">\n                    <h4><span class="widget__context-text"></span> <span class="widget__title"></span>:</h4>\n                    <table class="trade-table">\n                        <col class="trade-table__col">\n                        <col class="trade-table__col">\n                        <col class="trade-table__col">\n                        <thead>\n                            <th>Current price</th>\n                            <th>Total</th>\n                            <th class="widget__trade-context-text"></th>\n                        </thead>\n                        <tbody>\n                            <td class="widget__current-price"></td>\n                            <td class="widget__total"></td>\n                            <td class="widget__trade-context-value"></td>\n                        </tbody>\n                    </table>\n                    <div class="row modal__inner">\n                        <form class="trade-form col s12" id="trade-form" action="/" method="post">\n                            <div class="input-field col s4 trade-form__inner">\n                                <input class="widget__amount-inp" id="amount" type="number" min="'.concat(this._INPUT_MIN,'" step="any" required>\n                                <label class="amount-label" for="amount">Amount</label>\n                            </div>\n                            <button class="input-field col s3 waves-effect waves-teal btn-flat widget__trade-all-btn" type="button"><span class="widget__trade-all-text"></span> all</button>\n                            <div class="widget__form-feedback"></div>\n                        </form>\n                    </div>\n                </div>\n                <div class="modal-footer">\n                    <button class="waves-effect waves-teal btn-flat widget__submit-btn" form="trade-form" type="submit"></button>\n                    <button class="modal-close waves-effect waves-teal btn-flat widget__close-btn" type="button" data-target="modal">Cancel</button>\n                </div>\n            </div>\n        '),this._innerEls={modal:this._el.firstElementChild,closeBtn:this._el.querySelector(".widget__close-btn"),form:this._el.querySelector(".trade-form"),amountInp:this._el.querySelector(".widget__amount-inp"),amountLabel:this._el.querySelector(".amount-label"),submitBtn:this._el.querySelector(".widget__submit-btn"),formFeedback:this._el.querySelector(".widget__form-feedback"),titleText:this._el.querySelector(".widget__context-text"),titleItem:this._el.querySelector(".widget__title"),tradeText:this._el.querySelector(".widget__trade-context-text"),tradeAllText:this._el.querySelector(".widget__trade-all-text"),tradeAllBtn:this._el.querySelector(".widget__trade-all-btn"),currentPrice:this._el.querySelector(".widget__current-price"),total:this._el.querySelector(".widget__total"),tradeValue:this._el.querySelector(".widget__trade-context-value")},this._modal=M.Modal.init(this._innerEls.modal),this._el.addEventListener("input",(function(e){t._wasFormTouched=!0;var n=+e.target.value;t._updateAmount(n)})),this._el.addEventListener("click",(function(e){var n=e.target.closest(".widget__trade-all-btn"),i=e.target===t._innerEls.closeBtn;if(n){var r;r=t._isBuyingCtx?t._balance/t._currentItem.price_usd:t._itemAmount;var a=t._innerEls.amountInp;a.value=r,a.focus(),a.dispatchEvent(new Event("input",{bubbles:!0}))}i&&t.close()})),this._innerEls.form.addEventListener("submit",(function(e){t._onSubmitHandler(e)})),this._isBuyingCtx=!0}},{key:"_onSubmitHandler",value:function(t){t.preventDefault(),this._wasFormTouched=!0,this._reportValidity()&&(this._isBuyingCtx?this._onBuyCallback(this._currentItem.id,this._amount):this._onSellCallback(this._currentItem.id,this._amount),this.close())}},{key:"_formatPrice",value:function(t){return Number(t).toFixed(this._PRECISION)}}]),t}();new(function(){function t(e){var n=e.element,i=e.precision,a=void 0===i?4:i;r()(this,t),this._el=n,this._PRECISION=Math.trunc(a),this._initDataService(),this._render(),this._initTable(),this._initPortfolio(),this._initTradeWidget()}return o()(t,[{key:"_render",value:function(){this._el.innerHTML='\n            <div class="row">\n                <div class="col s12">\n                    <h1>Tiny Crypto Market</h1>\n                </div>\n            </div>\n            <div class="portfolio-wrap"></div>\n            <div class="row">\n                <div class="col s12 table-wrap"></div>\n            </div>\n            <div class="trade-widget"></div>\n        '}},{key:"_initTable",value:function(){var t=this;this._table=new _({element:this._el.querySelector(".table-wrap"),precision:this._PRECISION,onRowClick:function(e){t._tradeWidget.buy({item:t._currencyData.find((function(t){return e===t.id})),balance:t._portfolio.getBalance()})}})}},{key:"_initPortfolio",value:function(){var t=this;this._portfolio=new m({element:this._el.querySelector(".portfolio-wrap"),precision:this._PRECISION,balance:1e3,onRowClick:function(e,n){t._tradeWidget.sell({item:t._currencyData.find((function(t){return e===t.id})),itemAmount:n})}})}},{key:"_initTradeWidget",value:function(){var t=this;this._tradeWidget=new b({element:this._el.querySelector(".trade-widget"),precision:this._PRECISION,onBuy:function(e,n){t._portfolio.add(t._currencyData.find((function(t){return e===t.id})),n)},onSell:function(e,n){t._portfolio.remove(t._currencyData.find((function(t){return e===t.id})),n)}})}},{key:"_initDataService",value:function(){var t=this;this._currencyGetter=new s,this._currencyGetter.fetch().then((function(e){return t._onDataUpdate(e)})),this._updateInterval=setInterval((function(){return t._currencyGetter.fetch().then((function(e){return t._onDataUpdate(e)}))}),3e4)}},{key:"_onDataUpdate",value:function(t){if(this._isFatality(t))return clearInterval(this._updateInterval),void(this._el.innerHTML="New currency detected. App is too weak for dis shet! (author is lazy af)<br>App is dead btw. Расходимся.");this._currencyData=t,this._table.updateData(t),this._portfolio.updateData(t)}},{key:"_isFatality",value:function(t){var e=this;if(!this._currencyData)return this._knownCoins=new Set,t.forEach((function(t){e._knownCoins.add(t.id)})),!1;for(var n=!1,i=0;!n&&i<t.length;i++)n=!this._knownCoins.has(t[i].id);return n}}]),t}())({element:document.querySelector(".app"),precision:4})}]);
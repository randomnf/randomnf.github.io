var eventForm=document.querySelector(".add-event-popup"),closeForm=document.querySelector(".close-popup-form"),addEventLink=document.querySelector(".add-event-link");if(addEventLink){addEventLink.addEventListener("click",(function(e){eventForm.classList.add("opened")}))}
closeForm.addEventListener("click",(function(e){e.preventDefault();eventForm.classList.remove("opened")}));$(document).mouseup(function(e){var popupSection=$(".add-event-form-popup");if(!popupSection.is(e.target)&&popupSection.has(e.target).length===0)
closeForm.click()});document.querySelector("#close-msg-btn").addEventListener("click",function(){document.querySelector(".form-request-wrap").classList.remove("opened")});document.querySelector("#close-all-btn").addEventListener("click",function(){document.querySelector(".form-request-wrap").classList.remove("opened");document.querySelector(".request-msg").innerHTML="";eventForm.classList.remove("opened")});var submit_btn=document.getElementById("event-submit"),form_el=document.getElementById("add-event-form"),captchaIsChecked=!1,captchaIsSucceeded=!1;submit_btn.addEventListener("click",function(e){e.preventDefault();if(checkform()){captcha_succeeded()}});function capcha_filled(){captchaIsChecked=!0;document.getElementById("captcha_error").innerHTML="";document.querySelector(".g-recaptcha > div").classList.remove("cap_error")}
function capcha_expired(){captchaIsChecked=!1}
function captcha_succeeded(){$.ajax({url:"/recaptcha-check.php",type:"POST",dataType:"html",data:$("#add-event-form").serialize(),success:function(response){msgreport(parseInt(response))},error:function(jqXHR,exception){finalmessage(10)}})}
function msgreport(val){switch(val){case 0:document.getElementById("captcha_error").innerHTML="";document.querySelector(".g-recaptcha > div").classList.remove("cap_error");finalmessage(0);break;case 1:document.getElementById("captcha_error").innerHTML="";document.querySelector(".g-recaptcha > div").classList.remove("cap_error");formSend();break;default:finalmessage(10);break}}
function checkform(val){res=form_el.reportValidity();if(res&&captchaIsChecked)
return 1;if(!captchaIsChecked){document.getElementById("captcha_error").innerHTML=" Пройдите проверку CAPTCHA.";document.querySelector(".g-recaptcha > div").classList.add("cap_error")}
return 0}
function formSend(){$.ajax({url:"/ajax-send-event-request.php",type:"POST",dataType:"html",data:$("#add-event-form").serialize(),success:function(response){finalmessage(1)},error:function(jqXHR,exception){finalmessage(-1)}})}
function finalmessage(val){var msg="";switch(val){case-1:msg='Ой. Произошла ошибка во время отправки формы. Попробуйте обновить страницу и отправить форму еще раз.<br>Либо пишите нам напрямую на почту: <a class="read-more-link" href="mailto:hi@coinduck.ru">hi@coinduck.ru</a>';break;case 0:msg="Либо вы повторно пытаетесь отправить форму (нужно обновить страницу, чтобы reCaptcha обновилась), либо Google reCAPTCHA считает, что вы - бот =(";break;case 1:msg="Спасибо за обращение! Мы проверим вашу заявку и добавим ивент на сайт в ближайшее время.";break;default:msg='Произошла непредвиденная ошибка. Попробуйте отправить форму с другого браузера, либо напишите нам на почту: <a class="read-more-link" href="mailto:hi@coinduck.ru">hi@coinduck.ru</a>';break}
document.querySelector(".form-request-wrap").classList.add("opened");document.querySelector(".request-msg").innerHTML=msg}
